angular.module("rico",["ngRoute"]);var ricoApp=angular.module("rico");ricoApp.controller("listaOfertasCtrl",function($scope,$rootScope,listaOfertas,listaIndices){$scope.app="Produtos de Tesouro Direto",$scope.ofertas=listaOfertas.data,$scope.indices=listaIndices.data,$scope.indices.forEach(function(ind){$scope.txIPCA=ind.IPCA,$scope.txSELIC=ind.SELIC});var init=function(){calcularJurosMensal($scope.ofertas),0!=$rootScope.tempoInvest&&(calcularRentabilidade($scope.ofertas),$rootScope.data=preencher5Maiores($scope.ofertas))},calcularJurosMensal=function(ofertas){ofertas.forEach(function(produto){var txAnual=produto.currentInterestPercentageValue;"IPCA"===produto.index.name?txAnual+=$scope.txIPCA:"SELIC"===produto.index.name&&(txAnual+=txAnual+$scope.txSELIC);var a=1+txAnual,exp=1/12,jurosMes=100*(Math.pow(a,exp)-1);produto.txJurosMes=jurosMes.toFixed(5)})},calcularRentabilidade=function(ofertas){ofertas.forEach(function(produto){var N=$rootScope.tempoInvest,P=$rootScope.valorInvest;if(P>=produto.minimumValue){var a=1+produto.txJurosMes/100,b=Math.pow(a,N),M=(P*b).toFixed(2);produto.vlrResgate=M,produto.rentabilidade=M-P}else produto.vlrResgate=0,produto.rentabilidade=0})},preencher5Maiores=function(ofertas){var compareDescendente=function(a,b){return a.rentabilidade===b.rentabilidade?0:a.rentabilidade<b.rentabilidade?1:-1};ofertas.sort(compareDescendente);var arData=new Array;return arData=[{name:ofertas[0].name,y:parseFloat(ofertas[0].rentabilidade.toFixed(2))},{name:ofertas[1].name,y:parseFloat(ofertas[1].rentabilidade.toFixed(2))},{name:ofertas[2].name,y:parseFloat(ofertas[2].rentabilidade.toFixed(2))},{name:ofertas[3].name,y:parseFloat(ofertas[3].rentabilidade.toFixed(2))},{name:ofertas[4].name,y:parseFloat(ofertas[4].rentabilidade.toFixed(2))}]};init()}),ricoApp.controller("formInvestCtrl",function($scope,$rootScope,$location){var investido={};$rootScope.tempoInvest=0,$rootScope.valorInvest=0,$scope.simular=function(invest){investido=angular.copy(invest),investido.tempo%30==0?($rootScope.tempoInvest=investido.tempo/30,$rootScope.valorInvest=investido.valor,$location.path("/tesouro")):alert("Por favor, para o Tempo de Investimento, digite um múltiplo de 30, \npor exemplo: 30, 60, 90, 120, ...")}}),ricoApp.controller("hcChartCtrl",function($scope,$rootScope){var init=function(){var elem=$rootScope.data;$scope.chartOptions={chart:{type:"column"},title:{text:"Gráfico dos 5 melhores Investimentos"},xAxis:{type:"category"},yAxis:{title:{text:"Rentabilidade"}},legend:{enabled:!1},plotOptions:{series:{borderWidth:0,dataLabels:{enabled:!0,format:"R$ {point.y:.2f}"}}},tooltip:{headerFormat:'<span style="font-size:11px">{series.name}</span><br>',pointFormat:'<span style="color:{point.color}">{point.name}</span>: <b>R$ {point.y:.2f}</b><br/>'},series:[{name:"Rentabilidade",colorByPoint:!0,data:elem}]}};init()});var ricoApp=angular.module("rico");ricoApp.service("ofertasAPI",function($http,config){this.getOfertas=function(){return $http.get(config.baseUrl+"/tesouro")}}),ricoApp.service("indicesAPI",function($http,config){this.getIndices=function(){return $http.get(config.baseUrl+"/indexes")}});var ricoApp=angular.module("rico");ricoApp.constant("config",{baseUrl:"http://localhost:3000"}),ricoApp.run(function($rootScope){$rootScope.tempoInvest=0,$rootScope.valorInvest=0,$rootScope.data=[]}),angular.module("rico").config(function($routeProvider){$routeProvider.when("/tesouro",{templateUrl:"view/ofertas.html",controller:"listaOfertasCtrl",resolve:{listaOfertas:function(ofertasAPI){return ofertasAPI.getOfertas()},listaIndices:function(indicesAPI){return indicesAPI.getIndices()}}}).when("/investimento",{templateUrl:"view/investimento.html",controller:"formInvestCtrl",resolve:{listaOfertas:function(ofertasAPI){return ofertasAPI.getOfertas()}}}).otherwise({redirectTo:"/tesouro"})});var ricoApp=angular.module("rico");ricoApp.filter("mult100",function(){return function(input){var result=100*input;return parseFloat(result).toFixed(2)}});var ricoApp=angular.module("rico");ricoApp.directive("hcChart",function(){return{restrict:"E",template:"<div></div>",scope:{options:"="},link:function(scope,element){Highcharts.chart(element[0],scope.options)}}});